name: Update README

on:
  push:
    branches: [main]
  schedule:
    - cron: "0 6 * * *"  # Daily at 6 AM
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Get GitHub Data and Generate README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Create a simple Node.js script to fetch GitHub data
          cat > generate-readme.js << 'EOF'
          const https = require('https');
          
          const GITHUB_USERNAME = 'dacrab';
          const GITHUB_TOKEN = process.env.GITHUB_TOKEN;
          
          function makeRequest(url) {
            return new Promise((resolve, reject) => {
              const options = {
                headers: {
                  'User-Agent': 'README-Generator',
                  'Authorization': `token ${GITHUB_TOKEN}`
                }
              };
              
              https.get(url, options, (res) => {
                let data = '';
                res.on('data', chunk => data += chunk);
                res.on('end', () => {
                  try {
                    resolve(JSON.parse(data));
                  } catch (e) {
                    resolve({ error: e.message });
                  }
                });
              }).on('error', reject);
            });
          }
          
          async function generateReadme() {
            try {
              // Get recent repos
              const reposUrl = `https://api.github.com/users/${GITHUB_USERNAME}/repos?sort=updated&per_page=5`;
              const repos = await makeRequest(reposUrl);
              
              // Get user data
              const userUrl = `https://api.github.com/users/${GITHUB_USERNAME}`;
              const user = await makeRequest(userUrl);
              
              const today = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              });
              
              const readme = `# Hi there 👋 I'm Vaggelis Kavouras
          
          [![](https://readme-typing-svg.herokuapp.com/?lines=Welcome+to+my+GitHub+profile!;I'm+a+passionate+solo+developer;Always+learning+new+things&font=Fira%40Code&center=true)](https://github.com/dacrab)
          
          ## About Me
          
          I'm a solo developer from 🇬🇷 Greece with a passion for building modern web apps. I started with C and static websites — and now I create type-safe, full-stack, real-time apps using cutting-edge tools like Supabase, Next.js, and Tailwind CSS.
          
          I enjoy clean design, scalable code, and collaborating with like-minded devs. Always learning. Always shipping.
          🌍 Based in Greece
          
          ## 🛠️ Skills
          
          [![Supabase](https://img.shields.io/badge/Supabase-3ECF8E?style=for-the-badge&logo=supabase&logoColor=white)](https://supabase.com/)
          [![Next.js](https://img.shields.io/badge/Next.js-000000?style=for-the-badge&logo=next.js&logoColor=white)](https://nextjs.org/)
          [![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB)](https://reactjs.org/)
          [![Vite](https://img.shields.io/badge/Vite-646CFF?style=for-the-badge&logo=vite&logoColor=white)](https://vitejs.dev/)
          [![shadcn/ui](https://img.shields.io/badge/shadcn/ui-000000?style=for-the-badge&logo=shadcn&logoColor=white)](https://ui.shadcn.com/)
          [![Tailwind CSS](https://img.shields.io/badge/TailwindCSS-06B6D4?style=for-the-badge&logo=tailwind-css&logoColor=white)](https://tailwindcss.com/)
          [![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
          
          ## 🚀 Featured Projects
          
          | Project | Description |
          | --- | --- |
          | 🎯 [**Argicon**](https://argicon.gr) | Sleek architecture studio site with multilingual support and Framer Motion animations |
          | 🧱 [**DesignDash**](https://designdash.gr) | Bilingual architecture portfolio with light/dark mode, built with Next.js and Tailwind CSS |
          | 🧑‍💼 [**clubOS**](https://clubos.vercel.app) | POS and booking system for sports facilities with real-time data, RBAC, and analytics [Repo](https://github.com/dacrab/clubos) |
          | 🌐 [**Portfolio**](https://dacrab.github.io/) | My personal developer portfolio built with Next.js, TailwindCSS, and TypeScript [Repo](https://github.com/dacrab/portfolio) |
          
          ## 📊 GitHub Stats
          
          <div align="center">
          
          ![GitHub Metrics](https://raw.githubusercontent.com/dacrab/dacrab/main/github-metrics.svg)
          
          [![GitHub stats](https://github-readme-stats.vercel.app/api?username=dacrab&show_icons=true&theme=tokyonight&hide_border=true&bg_color=0D1117)](https://github.com/dacrab)
          
          [![GitHub Streak](https://github-readme-streak-stats.herokuapp.com/?user=dacrab&theme=tokyonight&hide_border=true&background=0D1117)](https://github.com/dacrab)
          
          [![Top Languages](https://github-readme-stats.vercel.app/api/top-langs/?username=dacrab&layout=compact&theme=tokyonight&hide_border=true&bg_color=0D1117)](https://github.com/dacrab)
          
          </div>
          
          ## 🌱 My Latest Projects
          ${Array.isArray(repos) ? repos.filter(repo => !repo.fork && repo.description).slice(0, 5).map(repo => 
            `- [**${repo.name}**](${repo.html_url}) - ${repo.description}`
          ).join('\n') : '- Loading projects...'}
          
          ## 📈 GitHub Activity
          
          - 🔭 **${user.public_repos || '?'}** Public repositories
          - 👥 **${user.followers || '?'}** Followers
          - ⭐ Repositories starred by the community
          - 🌍 Based in **Greece** 🇬🇷
          
          ## 🤝 Let's Connect!
          
          <div align="center">
          
          [![Instagram](https://img.shields.io/badge/Instagram-E4405F?style=for-the-badge&logo=instagram&logoColor=white)](https://www.instagram.com/killcrb/)
          [![GitHub](https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/dacrab)
          [![LinkedIn](https://img.shields.io/badge/LinkedIn-0077B5?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/vkavouras/)
          
          </div>
          
          ---
          
          <div align="center">
          
          **✨ Always learning, always building, always shipping! ✨**
          
          *Last updated: ${today}*
          
          </div>`;
              
              require('fs').writeFileSync('README.md', readme);
              console.log('✅ README.md generated successfully!');
              
            } catch (error) {
              console.error('❌ Error generating README:', error);
              process.exit(1);
            }
          }
          
          generateReadme();
          EOF
          
          # Run the script
          node generate-readme.js
          
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: '📄 Auto-update README'
          file_pattern: 'README.md'
          commit_user_name: 'readme-bot'
          commit_user_email: 'actions@github.com'
